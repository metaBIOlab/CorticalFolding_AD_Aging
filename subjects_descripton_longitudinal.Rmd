---
title: "subjects_descripton_flowchart"
author: "Fernanda Hansen Pacheco de Moraes"
date: "2023-01-16"
output:
  html_document: 
    fig_width: 8
    number_sections: yes
    theme: paper
    toc: yes
    toc_depth: 6
editor_options: 
  chunk_output_type: inline
---

# RMARKDOWN AND R SETUP
```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	cache = TRUE
)
```

```{r working directory}
setwd("~/GitHub/CorticalFolding_AD_Aging")
```

```{r call packages}
library(readr)
library(readxl)
library(tidyverse)
library(lubridate)
library(dtrackr)
library(ggpubr)
```

# set seed for random process

```{r}
set.seed(1)
```

# import subjs info

```{r}
subjects <- read_csv(
  "tabela_sujeitos.csv",
  col_types = cols(
    ...1 = col_skip(),
    age = col_skip(),
    dob = col_skip(),
    SUBJ = col_skip(),
    Session = col_skip(),
    Gender = col_skip(),
    birthday = col_skip(),
    Birthdate = col_skip(),
    NeuroQuant = col_skip(),
    Lipoxina = col_skip()
  )
) %>%
  mutate(SUBJ = str_sub(participant_id, 5, 11),
         Session = as.double(str_sub(session_id, 5, 5)))

subjects_esc <- subjects %>%
  dplyr::select(c(participant_id, ESC)) %>%
  filter(!is.na(ESC)) %>%
  unique()

subjects <- subjects %>%
  dplyr::select(-c(ESC)) %>%
  full_join(subjects_esc)
```

Translate Diagnostics labels to English

```{r}
subjects$Diagnostic[subjects$Diagnostic == "CONTROLE"] <- "CTL"
subjects$Diagnostic[subjects$Diagnostic == "ALZ"] <- "AD"
subjects$Diagnostic[subjects$Diagnostic == "CCL"] <- "MCI"

subjects$Diagnostic <- factor(subjects$Diagnostic, levels = c("AD", "MCI","CTL"))

```

Merging with morphometrical data to ensure FreeSurfer completition + clinical and CSF data

```{r}
dados_raw <- read_csv("dados_raw.csv") %>%
  filter(hemi == "L", ROI == "hemisphere")  %>% # here I selected results for the left hemisphere and ROI the complete hemisphere
  dplyr::select(c(SUBJ, Session, AvgThickness, ExposedArea))

subjects <- full_join(subjects, dados_raw)
```


# Visual quality Control

```{r}
VisualQC  <- read_excel("Verificacao qualidade segmentacao FS Zika e CCD 2.xlsx",
    sheet = "AD - IDOR ses 1 long", col_types = c("text", 
        "text", "text", "skip", "numeric", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip")) %>%
  mutate(Session = as.double(str_sub(Session,5,5)),
          Classification = Fernanda) %>%
  dplyr::select(-c(Fernanda))
         
subjects <- full_join(subjects, VisualQC) %>%
  dplyr::select(-c(`Longitudinal correction`, acq_date))

write.csv(subjects, "subjects.csv")

```

## Diagnostic transition

All filters were directly included to ensure only the conforming subjects would be included in this counting.

### summary
```{r}

subjects %>%
  filter(!is.na(Diagnostic), !is.na(AvgThickness), !is.na(ExposedArea), machine == "Philips-Achieva", Classification == 1 | Classification == 2 | is.na(Classification), ESC == 8 | ESC > 8) %>% ## ses-2 and ses-3 images did not go through VisualCQ since were not included in the study
  dplyr::select(-c(AvgThickness, ExposedArea, machine, Classification, Age, SUBJ, Session)) %>%
  pivot_wider(names_from = session_id, values_from = Diagnostic) %>%
  summarise(N = length(which(!is.na(`ses-1`))),
            N2 = length(which(!is.na(`ses-2`))),
            N3 = length(which(!is.na(`ses-3`))))

```

### starting at MCI
```{r}

subjects %>%
  filter(!is.na(Diagnostic), !is.na(AvgThickness), !is.na(ExposedArea), machine == "Philips-Achieva", Classification == 1 | Classification == 2 | is.na(Classification), ESC == 8 | ESC > 8) %>% ## ses-2 and ses-3 images did not go through VisualCQ since were not included in the study
  dplyr::select(-c(AvgThickness, ExposedArea, machine, Classification, Age, SUBJ, Session)) %>%
  pivot_wider(names_from = session_id, values_from = Diagnostic) %>%
  filter(`ses-1`== "MCI") %>%
  summarise(N = length(which(!is.na(`ses-1`))),
            N2 = length(which(!is.na(`ses-2`))),
            N3 = length(which(!is.na(`ses-3`))))

subjects %>%
  filter(!is.na(Diagnostic), !is.na(AvgThickness), !is.na(ExposedArea), machine == "Philips-Achieva", Classification == 1 | Classification == 2 | is.na(Classification), ESC == 8 | ESC > 8) %>% ## ses-2 and ses-3 images did not go through VisualCQ since were not included in the study
  dplyr::select(-c(AvgThickness, ExposedArea, machine, Classification, Age, SUBJ, Session)) %>%
  pivot_wider(names_from = session_id, values_from = Diagnostic) %>%
  filter(`ses-1`== "MCI")

```
